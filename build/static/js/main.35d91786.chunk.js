(this["webpackJsonpthe-dojo"]=this["webpackJsonpthe-dojo"]||[]).push([[0],{39:function(e,t,s){},44:function(e,t,s){},45:function(e,t,s){},46:function(e,t,s){},47:function(e,t,s){},52:function(e,t,s){},53:function(e,t,s){},54:function(e,t,s){},55:function(e,t,s){},56:function(e,t,s){},80:function(e,t,s){},81:function(e,t,s){},82:function(e,t,s){"use strict";s.r(t);var c=s(1),a=s.n(c),n=s(17),r=s.n(n),l=(s(39),s(8)),i=s(15),o=s(16);s(84),s(41),s(83);o.a.initializeApp({apiKey:"AIzaSyAYUPJPS1S3OVenKyc6OjKw39o5lCMj-lM",authDomain:"dojo-2f5e6.firebaseapp.com",projectId:"dojo-2f5e6",storageBucket:"dojo-2f5e6.appspot.com",messagingSenderId:"567484129299",appId:"1:567484129299:web:ce235c723e0c292e049fe6"});const j=o.a.firestore(),d=o.a.auth(),u=o.a.storage(),b=o.a.firestore.Timestamp;var O=s(2);const h=Object(c.createContext)(),p=(e,t)=>{switch(t.type){case"LOGIN":return{...e,user:t.payload};case"LOGOUT":return{...e,user:null};case"AUTH_IS_READY":return{user:t.payload,authIsReady:!0};default:return e}},m=e=>{let{children:t}=e;const[s,a]=Object(c.useReducer)(p,{user:null,authIsReady:!1});return Object(c.useEffect)((()=>{const e=d.onAuthStateChanged((t=>{a({type:"AUTH_IS_READY",payload:t}),e()}))}),[]),console.log("AuthContext state:",s),Object(O.jsx)(h.Provider,{value:{...s,dispatch:a},children:t})},x=()=>{const e=Object(c.useContext)(h);if(!e)throw Error("useAuthContext must be used inside an AuthContextProvider");return e};s(44);var g=()=>{const[e,t]=Object(c.useState)(""),[s,a]=Object(c.useState)(""),{error:n,isPending:r,login:l}=(()=>{const[e,t]=Object(c.useState)(!1),[s,a]=Object(c.useState)(null),[n,r]=Object(c.useState)(!1),{dispatch:l}=x();return Object(c.useEffect)((()=>()=>t(!0)),[]),{login:async(t,s)=>{a(null),r(!0);try{const c=await d.signInWithEmailAndPassword(t,s);j.collection("users").doc(c.user.uid).update({online:!0}),l({type:"LOGIN",payload:c.user}),e||(r(!1),a(null))}catch(c){if(!e){const e=JSON.parse(c.message);a(e.error.message),r(!1)}}},isPending:n,error:s}})();return Object(O.jsxs)("form",{className:"auth-form",onSubmit:function(t){t.preventDefault(),l(e,s)},children:[Object(O.jsx)("h2",{children:"Login"}),Object(O.jsxs)("label",{children:[Object(O.jsx)("span",{children:"email:"}),Object(O.jsx)("input",{required:!0,type:"email",onChange:e=>t(e.target.value),value:e})]}),Object(O.jsxs)("label",{children:[Object(O.jsx)("span",{children:"password:"}),Object(O.jsx)("input",{required:!0,type:"password",onChange:e=>a(e.target.value),value:s})]}),!r&&Object(O.jsx)("button",{className:"btn",children:"Login"}),r&&Object(O.jsx)("button",{className:"btn",disabled:!0,children:"loading..."}),n&&Object(O.jsx)("div",{className:"error",children:n})]})};s(45);var v=()=>{const[e,t]=Object(c.useState)(""),[s,a]=Object(c.useState)(""),[n,r]=Object(c.useState)(""),[l,i]=Object(c.useState)(null),[o,b]=Object(c.useState)(null),{signup:h,isPending:p,error:m}=(()=>{const[e,t]=Object(c.useState)(!1),[s,a]=Object(c.useState)(null),[n,r]=Object(c.useState)(!1),{dispatch:l}=x();return Object(c.useEffect)((()=>()=>t(!0)),[]),{signup:async(t,s,c,n)=>{a(null),r(!0);try{const i=await d.createUserWithEmailAndPassword(t,s);if(!i)throw new Error("Could not complete signup");const o=`thumbnails/${i.user.uid}/${n.name}`,b=await u.ref(o).put(n),O=await b.ref.getDownloadURL();await i.user.updateProfile({displayName:c,photoURL:O}),await j.collection("users").doc(i.user.uid).set({online:!0,displayName:c,photoURL:O}),l({type:"LOGIN",payload:i.user}),e||(r(!1),a(null))}catch(i){e||(a(i.message),r(!1))}},error:s,isPending:n}})();return Object(O.jsxs)("form",{className:"auth-form",onSubmit:function(t){t.preventDefault(),h(e,s,n,l)},children:[Object(O.jsx)("h2",{children:"Sign up"}),Object(O.jsxs)("label",{children:[Object(O.jsx)("span",{children:"email:"}),Object(O.jsx)("input",{required:!0,type:"email",onChange:e=>t(e.target.value),value:e})]}),Object(O.jsxs)("label",{children:[Object(O.jsx)("span",{children:"password:"}),Object(O.jsx)("input",{required:!0,type:"password",onChange:e=>a(e.target.value),value:s})]}),Object(O.jsxs)("label",{children:[Object(O.jsx)("span",{children:"display name:"}),Object(O.jsx)("input",{required:!0,type:"rext",onChange:e=>r(e.target.value),value:n})]}),Object(O.jsxs)("label",{children:[Object(O.jsx)("span",{children:"profile thumbnail:"}),Object(O.jsx)("input",{required:!0,type:"file",onChange:function(e){i(null);let t=e.target.files[0];t?t.type.includes("image")?t.size>1e5?b("Image files size must be less than 100kb"):(b(null),i(t)):b("Selected file must be an image"):b("Please select a file")}}),o&&Object(O.jsx)("div",{className:"error",children:o})]}),!p&&Object(O.jsx)("button",{className:"btn",children:"Sign up"}),p&&Object(O.jsx)("button",{className:"btn",disabled:!0,children:"loading..."}),m&&Object(O.jsx)("div",{className:"error",children:m})]})};const f=(e,t,s)=>{const[a,n]=Object(c.useState)(null),[r,l]=Object(c.useState)(null),i=Object(c.useRef)(t).current,o=Object(c.useRef)(s).current;return Object(c.useEffect)((()=>{let t=j.collection(e);i&&(t=t.where(...i)),o&&(t=t.orderBy(...o));const s=t.onSnapshot((e=>{let t=[];e.docs.forEach((e=>{t.push({...e.data(),id:e.id})})),n(t),l(null)}),(e=>{console.log(e),l("could not fetch the data")}));return()=>s()}),[e,i,o]),{documents:a,error:r}};s(46);var y=e=>{let{src:t}=e;return Object(O.jsx)("div",{className:"avatar",children:Object(O.jsx)("img",{src:t,alt:"user avatar"})})};s(47);var N=e=>{let{projects:t}=e;return Object(O.jsxs)("div",{className:"project-list",children:[0===t.length&&Object(O.jsx)("p",{children:"No projects"}),t.map((e=>Object(O.jsxs)(l.b,{to:`/projects/${e.id}`,children:[Object(O.jsx)("h4",{children:e.name}),Object(O.jsxs)("p",{children:["Due by ",e.dueDate.toDate().toDateString()]}),Object(O.jsx)("div",{className:"assigned-to",children:Object(O.jsx)("ul",{children:e.assignedUsersList.map((e=>Object(O.jsx)("li",{children:Object(O.jsx)(y,{src:e.photoURL})},e.photoURL)))})})]},e.id)))]})};const D=["all","mine","development","design","marketing","sales"];var S=e=>{let{currentFilter:t,changeFilter:s}=e;return Object(O.jsx)("div",{className:"project-filter",children:Object(O.jsxs)("nav",{children:[Object(O.jsx)("p",{children:"Fitler by:"}),D.map((e=>Object(O.jsx)("button",{onClick:()=>s(e),className:t===e?"active":"",children:e},e)))]})})};s(52);var E=()=>{const{documents:e,error:t}=f("projects"),[s,a]=Object(c.useState)("all"),{user:n}=x();const r=null===e||void 0===e?void 0:e.filter((e=>{var t;switch(s){case"all":return!0;case"mine":let c=!1;return null===(t=e.assignedUsersList)||void 0===t||t.forEach((e=>{n.uid===e.id&&(c=!0)})),c;case"development":case"design":case"sales":case"marketing":return e.category===s;default:return!0}}));return Object(O.jsxs)("div",{children:[Object(O.jsx)("h2",{className:"page-title",children:"Dashboard"}),t&&Object(O.jsx)("p",{className:"error",children:t}),e&&Object(O.jsx)(S,{currentFilter:s,changeFilter:function(e){a(e)}}),r&&Object(O.jsx)(N,{projects:r})]})};let w={document:null,isPending:!1,error:null,success:null};const R=(e,t)=>{switch(t.type){case"IS_PENDING":return{isPending:!0,document:null,success:!1,error:null};case"ADDED_DOCUMENT":return{isPending:!1,document:t.payload,success:!0,error:null};case"DELETED_DOCUMENT":return{isPending:!1,document:null,success:!0,error:null};case"ERROR":return{isPending:!1,document:null,success:!1,error:t.payload};case"UPDATED_DOCUMENT":return{isPending:!1,document:t.payload,success:!0,error:null};default:return e}},P=e=>{const[t,s]=Object(c.useReducer)(R,w),[a,n]=Object(c.useState)(!1),r=j.collection(e),l=e=>{a||s(e)};return Object(c.useEffect)((()=>()=>n(!0)),[]),{addDocument:async e=>{s({type:"IS_PENDING"});try{const t=b.fromDate(new Date),s=await r.add({...e,createdAt:t});l({type:"ADDED_DOCUMENT",payload:s})}catch(t){l({type:"ERROR",payload:t.message})}},deleteDocument:async e=>{s({type:"IS_PENDING"});try{await r.doc(e).delete(),l({type:"DELETED_DOCUMENT"})}catch(t){l({type:"ERROR",payload:"could not delete"})}},response:t,updateDocument:async(e,t)=>{s({type:"IS_PENDING"});try{const s=await r.doc(e).update(t);return l({type:"UPDATED_DOCUMENT",payload:s}),s}catch(c){l({type:"ERROR",payload:c.message})}}}};var U=e=>{var t;let{project:s}=e;const{deleteDocument:c}=P("projects"),{user:a}=x(),n=Object(i.g)();return Object(O.jsxs)("div",{className:"project-summary",children:[Object(O.jsx)("h2",{className:"prage-title",children:s.name}),Object(O.jsxs)("p",{className:"due-date",children:["Proyect due by ",s.dueDate.toDate().toDateString()]}),Object(O.jsx)("p",{className:"details",children:s.details}),Object(O.jsx)("h4",{children:"Project is assiggned to:"}),null===(t=s.assignedUsersList)||void 0===t?void 0:t.map((e=>Object(O.jsx)("div",{children:Object(O.jsx)(y,{src:e.photoURL})},e.id))),a.uid===s.createdBy.id&&Object(O.jsx)("button",{className:"btn",onClick:function(){c(s.id),n.push("/")},children:"Mark as Completed"})]})},C=s(34);var L=e=>{var t;let{project:s}=e;const[a,n]=Object(c.useState)(""),{user:r}=x(),{updateDocument:l,response:i}=P("projects");return Object(O.jsxs)("div",{className:"project-comments",children:[Object(O.jsx)("h4",{children:"Project Comments"}),Object(O.jsx)("ul",{children:s.comments.length>0&&(null===(t=s.comments)||void 0===t?void 0:t.map((e=>Object(O.jsxs)("li",{children:[Object(O.jsxs)("div",{className:"comment-author",children:[Object(O.jsx)(y,{src:e.photoURL}),Object(O.jsx)("p",{children:e.displayName})]}),Object(O.jsx)("div",{className:"comment-date",children:Object(O.jsx)("p",{children:Object(C.a)(e.createdAt.toDate(),{addSuffix:!0})})}),Object(O.jsx)("div",{className:"comment-content",children:Object(O.jsx)("p",{children:e.content})})]},e.id))))}),Object(O.jsxs)("form",{className:"add-comment",onSubmit:async function(e){e.preventDefault();const t={displayName:r.displayName,photoURL:r.photoURL,content:a,createdAt:b.fromDate(new Date),id:Math.random()};await l(s.id,{comments:[...s.comments,t]}),i.error||n("")},children:[Object(O.jsxs)("label",{children:[Object(O.jsx)("span",{children:"Add new comment:"}),Object(O.jsx)("textarea",{required:!0,onChange:e=>n(e.target.value),value:a})]}),Object(O.jsx)("button",{className:"btn",children:"Add Comment"})]})]})};s(53);var A=()=>{const{id:e}=Object(i.h)(),{error:t,document:s}=((e,t)=>{const[s,a]=Object(c.useState)(null),[n,r]=Object(c.useState)(null);return Object(c.useEffect)((()=>{const s=j.collection(e).doc(t).onSnapshot((e=>{e.data()?(a({...e.data(),id:e.id}),r(null)):r("no such document exists")}),(e=>{console.log(e.message),r("failed to get document")}));return()=>s()}),[e,t]),{document:s,error:n}})("projects",e);return t?Object(O.jsx)("div",{className:"error",children:t}):s?Object(O.jsxs)("div",{className:"project-details",children:[Object(O.jsx)(U,{project:s}),Object(O.jsx)(L,{project:s})]}):Object(O.jsx)("div",{children:"Loading..."})};var I=s.p+"static/media/temple.c57f882d.svg";s(54);var T=()=>{const{logout:e,isPending:t}=(()=>{const[e,t]=Object(c.useState)(!1),[s,a]=Object(c.useState)(null),[n,r]=Object(c.useState)(!1),{dispatch:l,user:i}=x();return Object(c.useEffect)((()=>()=>t(!0)),[]),{logout:async()=>{a(null),r(!0);try{const{uid:t}=i;await j.collection("users").doc(t).update({online:!1}),await d.signOut(),l({type:"LOGOUT"}),e||(r(!1),a(null))}catch(t){e||(a(t.message),r(!1))}},error:s,isPending:n}})(),{user:s}=x();return Object(O.jsx)("div",{className:"navbar",children:Object(O.jsxs)("ul",{children:[Object(O.jsxs)("li",{className:"logo",children:[Object(O.jsx)("img",{src:I,alt:"logo"}),Object(O.jsx)("span",{children:"The Dojo"})]}),!s&&Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("li",{children:Object(O.jsx)(l.b,{to:"/login",children:"Login"})}),Object(O.jsx)("li",{children:Object(O.jsx)(l.b,{to:"/signup",children:"Signup"})})]}),s&&Object(O.jsxs)("li",{children:[!t&&Object(O.jsx)("button",{className:"btn",onClick:e,children:"Logout"}),t&&Object(O.jsx)("button",{className:"btn",disabled:!0,children:"Logging out..."})]})]})})},_=(s(55),s.p+"static/media/dashboard_icon.bc800f3b.svg"),k=s.p+"static/media/add_icon.376e9b6a.svg";var M=()=>{const{user:e}=x();return Object(O.jsx)("div",{className:"sidebar",children:Object(O.jsxs)("div",{className:"siderbar-content",children:[Object(O.jsxs)("div",{className:"user",children:[Object(O.jsx)(y,{src:e.photoURL}),Object(O.jsxs)("p",{children:["Hey ",e.displayName]})]}),Object(O.jsx)("nav",{className:"links",children:Object(O.jsxs)("ul",{children:[Object(O.jsx)("li",{children:Object(O.jsxs)(l.c,{to:"/",children:[Object(O.jsx)("img",{src:_,alt:"dashboard icon"}),Object(O.jsx)("span",{children:"Dashboard"})]})}),Object(O.jsx)("li",{children:Object(O.jsxs)(l.c,{to:"/create",children:[Object(O.jsx)("img",{src:k,alt:"add project icon"}),Object(O.jsx)("span",{children:"New Project"})]})})]})})]})})},q=s(27);s(56);const G=[{value:"development",label:"Development"},{value:"design",label:"Design"},{value:"sales",label:"Sales"},{value:"marketing",label:"Marketing"}];var F=()=>{const e=Object(i.g)(),{documents:t,errors:s}=f("users"),{user:a}=x(),{addDocument:n,response:r}=P("projects"),[l,o]=Object(c.useState)(""),[j,d]=Object(c.useState)(""),[u,h]=Object(c.useState)(""),[p,m]=Object(c.useState)(""),[g,v]=Object(c.useState)([]),[y,N]=Object(c.useState)([]),[D,S]=Object(c.useState)(null);return Object(c.useEffect)((()=>{if(t){const e=t.map((e=>({label:e.displayName,value:e,id:e.id})));N(e)}}),[t]),Object(O.jsxs)("div",{className:"create-form",children:[Object(O.jsx)("h2",{className:"page-title",children:"Create a new project"}),Object(O.jsxs)("form",{onSubmit:async function(t){if(t.preventDefault(),S(null),!p)return void S("Please select a project category");if(!g.length)return void S("Please assign the project to at least 1 user");const s={displayName:a.displayName,photoURL:a.photoURL,id:a.uid},c=g.map((e=>({displayName:e.value.displayName,photoURL:e.value.photoURL,id:e.value.id}))),i={name:l,details:j,category:p.value,dueDate:b.fromDate(new Date(u)),comments:[],createdBy:s,assignedUsersList:c};console.log(i),await n(i),r.error||e.push("/")},children:[Object(O.jsxs)("label",{children:[Object(O.jsx)("span",{children:"Project name:"}),Object(O.jsx)("input",{type:"text",onChange:e=>o(e.target.value),value:l,required:!0})]}),Object(O.jsxs)("label",{children:[Object(O.jsx)("span",{children:"Details:"}),Object(O.jsx)("textarea",{onChange:e=>d(e.target.value),value:j,required:!0})]}),Object(O.jsxs)("label",{children:[Object(O.jsx)("span",{children:"Set due date:"}),Object(O.jsx)("input",{type:"date",onChange:e=>h(e.target.value),value:u,required:!0})]}),Object(O.jsxs)("label",{children:[Object(O.jsx)("span",{children:"Project category:"}),Object(O.jsx)(q.a,{options:G,onChange:e=>m(e)})]}),Object(O.jsxs)("label",{children:[Object(O.jsx)("span",{children:"Assign to:"}),Object(O.jsx)(q.a,{options:y,onChange:e=>v(e),isMulti:!0})]}),Object(O.jsx)("button",{className:"btn",children:"Add project"}),D&&Object(O.jsx)("p",{className:"error",children:D})]})]})};s(80);var B=()=>{const{error:e,documents:t}=f("users");return Object(O.jsxs)("div",{className:"user-list",children:[Object(O.jsx)("h2",{children:"All Users"}),e&&Object(O.jsx)("div",{className:"error",children:e}),t&&t.map((e=>Object(O.jsxs)("div",{className:"user-list-item",children:[e.online&&Object(O.jsx)("span",{className:"online-user"}),Object(O.jsx)("span",{children:e.displayName}),Object(O.jsx)(y,{src:e.photoURL})]},e.id)))]})};s(81);var z=function(){const{user:e,authIsReady:t}=x();return Object(O.jsx)("div",{className:"App",children:t&&Object(O.jsxs)(l.a,{children:[e&&Object(O.jsx)(M,{}),Object(O.jsxs)("div",{className:"container",children:[Object(O.jsx)(T,{}),Object(O.jsxs)(i.d,{children:[Object(O.jsxs)(i.b,{exact:!0,path:"/",children:[e&&Object(O.jsx)(E,{}),!e&&Object(O.jsx)(i.a,{to:"/login"})]}),Object(O.jsxs)(i.b,{path:"/create",children:[e&&Object(O.jsx)(F,{}),!e&&Object(O.jsx)(i.a,{to:"/login"})]}),Object(O.jsxs)(i.b,{path:"/projects/:id",children:[e&&Object(O.jsx)(A,{}),!e&&Object(O.jsx)(i.a,{to:"/login"})]}),Object(O.jsxs)(i.b,{path:"/login",children:[e&&Object(O.jsx)(i.a,{to:"/"}),!e&&Object(O.jsx)(g,{})]}),Object(O.jsxs)(i.b,{path:"/signup",children:[e&&Object(O.jsx)(i.a,{to:"/"}),!e&&Object(O.jsx)(v,{})]})]})]}),e&&Object(O.jsx)(B,{})]})})};r.a.render(Object(O.jsx)(a.a.StrictMode,{children:Object(O.jsx)(m,{children:Object(O.jsx)(z,{})})}),document.getElementById("root"))}},[[82,1,2]]]);
//# sourceMappingURL=main.35d91786.chunk.js.map